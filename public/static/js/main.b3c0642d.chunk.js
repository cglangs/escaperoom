(this.webpackJsonpescapegame=this.webpackJsonpescapegame||[]).push([[0],{232:function(e,t,n){},261:function(e,t,n){},268:function(e,t){},270:function(e,t){},283:function(e,t,n){"use strict";n.r(t);var i=n(52),a=n(32),o=n.n(a),r=n(223),s=n.n(r),c=(n(232),n(226)),l=n(172),u=n(75),h=n(76),d=n(24),f=n(173),m=function(){function e(t,n){Object(u.a)(this,e),console.log(n),this.playerMesh=t,this.username=n,this.create()}return Object(h.a)(e,[{key:"create",value:function(){this.mesh=d.f.CreatePlane("billboard",{width:e.width,height:e.height},v.scene),this.mesh.position=d.n.Zero(),this.mesh.position.y=w.height-e.height;var t=f.a.CreateForMesh(this.mesh,1024,256);t.name="AvatarBillboard";var n=new f.b("container");n.thickness=0,n.height="100px",n.width="800px",t.addControl(n),this.text=new f.c,this.text.fontFamily="Arial",this.text.fontWeight="bold",this.text.color="white",this.text.outlineColor="black",this.text.outlineWidth=40,this.text.fontSize=100,n.addControl(this.text),this.text.text=this.username,this.mesh.billboardMode=d.e.BILLBOARDMODE_ALL,this.mesh.parent=this.playerMesh}}]),e}();m.height=1,m.width=3;var p=function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,null,[{key:"init",value:function(){window.addEventListener("keydown",this.keydownEvent),window.addEventListener("keyup",this.keyupEvent),window.addEventListener("blur",this.keyupEvent)}},{key:"keydownEvent",value:function(t){switch(t.keyCode){case 38:case 87:t.preventDefault(),e.key.up=!0;break;case 37:case 65:e.key.left=!0;break;case 39:case 68:e.key.right=!0;break;case 40:case 83:e.key.down=!0}}},{key:"keyupEvent",value:function(t){switch(t.keyCode){case 38:case 87:t.preventDefault(),e.key.up=!1;break;case 37:case 65:e.key.left=!1;break;case 39:case 68:e.key.right=!1;break;case 40:case 83:e.key.down=!1}}}]),e}();p.key={down:!1,up:!1,left:!1,right:!1};var w=function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,null,[{key:"init",value:function(t){e.mesh=d.f.CreateBox("avatar",{height:e.height,width:1,depth:1},v.scene),e.mesh.position=d.n.Zero(),e.mesh.position.y=e.height/2,e.mesh.isVisible=!1,e.username=t}},{key:"send",value:function(){var t=e.mesh.position.x,n=e.mesh.position.y,i=e.mesh.position.z,a=e.absoluteRotation;y.socket.emit("transform",{command:"playerMoved",x:t,y:n,z:i,rotation:a})}},{key:"update",value:function(t){null!==e.mesh&&(e.mesh.position=t,e.send())}}]),e}();w.absoluteRotation=0,w.height=3,w.mesh=null,w.rotationSpeed=.01,w.walkSpeed=.007;var v=function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,null,[{key:"init",value:function(){e.canvas=document.getElementById("canvas");var t=new d.c(e.canvas,!0);e.scene=new d.i(t),e.scene.gravity=new d.n(0,-.9,0),e.scene.collisionsEnabled=!0,e.setupCamera(),e.setupLights(),e.setupGround(),e.setupWalls(),t.runRenderLoop((function(){e.scene.render(),w.update(e.camera.position)})),window.addEventListener("resize",(function(){t.resize()}))}},{key:"setupCamera",value:function(){e.camera=new d.d("FreeCamera",new d.n(-5,2,-5),e.scene),e.camera.attachControl(e.canvas,!0),e.scene.activeCameras.push(e.camera),e.camera.checkCollisions=!0,e.camera.applyGravity=!0,e.camera.ellipsoid=new d.n(1.5,1,1.5),e.camera.speed=.1,e.camera.keysUp.push(87),e.camera.keysDown.push(83),e.camera.keysRight.push(68),e.camera.keysLeft.push(65)}},{key:"setupGround",value:function(){var t=d.e.CreatePlane("ground",20,e.scene);t.material=new d.k("groundMat",e.scene),t.material.diffuseTexture=new d.l("wood_floor_texture.jpg",e.scene),t.position=new d.n(0,0,0),t.rotation=new d.n(Math.PI/2,0,0),t.checkCollisions=!0}},{key:"setupWalls",value:function(){var t=d.f.CreateBox("wall1",{width:20,height:10,depth:2,sideOrientation:d.e.DOUBLESIDE},e.scene);t.checkCollisions=!0,t.material=new d.k(""),t.position=new d.n(0,1,11),t.material.diffuseTexture=new d.l("office_wall_texture.jpg",e.scene);var n=d.f.CreateBox("wall2",{width:20,height:10,depth:2,sideOrientation:d.e.DOUBLESIDE},e.scene);n.checkCollisions=!0,n.position=new d.n(11,1,0),n.material=new d.k(""),n.rotation=new d.n(0,d.m.ToRadians(90),0),n.material.diffuseTexture=new d.l("office_wall_texture.jpg",e.scene);var i=d.f.CreateBox("wall3",{width:20,height:10,depth:2,sideOrientation:d.e.DOUBLESIDE},e.scene);i.checkCollisions=!0,i.material=new d.k(""),i.position=new d.n(0,1,-11),i.material.diffuseTexture=new d.l("office_wall_texture.jpg",e.scene);var a=d.f.CreateBox("wall4Left",{width:8,height:10,depth:2,sideOrientation:d.e.DOUBLESIDE},e.scene);a.checkCollisions=!0,a.position=new d.n(-11,1,-6),a.material=new d.k(""),a.rotation=new d.n(0,d.m.ToRadians(90),0),a.material.diffuseTexture=new d.l("office_wall_texture.jpg",e.scene);var o=d.f.CreateBox("wall4Right",{width:8,height:10,depth:2,sideOrientation:d.e.DOUBLESIDE},e.scene);o.checkCollisions=!0,o.position=new d.n(-11,1,6),o.material=new d.k(""),o.rotation=new d.n(0,d.m.ToRadians(90),0),o.material.diffuseTexture=new d.l("office_wall_texture.jpg",e.scene);var r=d.f.CreateBox("wall4Arch",{width:4,height:2,depth:2,sideOrientation:d.e.DOUBLESIDE},e.scene);r.checkCollisions=!0,r.position=new d.n(-11,5,0),r.material=new d.k(""),r.rotation=new d.n(0,d.m.ToRadians(90),0),r.material.diffuseTexture=new d.l("office_wall_texture.jpg",e.scene);var s=d.f.CreateBox("wall4Door",{width:4,height:4,depth:2,sideOrientation:d.e.DOUBLESIDE},e.scene);s.checkCollisions=!0,s.position=new d.n(-11,2,0),s.material=new d.k(""),s.rotation=new d.n(0,d.m.ToRadians(90),0),s.material.diffuseTexture=new d.l("double_door_texture.jpg",e.scene);var c=d.f.CreateBox("roof",{width:20,height:2,depth:20,sideOrientation:d.e.DOUBLESIDE},e.scene);c.position=new d.n(0,7,0),c.material=new d.k(""),c.material.diffuseTexture=new d.l("wall_texture.jpg",e.scene),d.j.ImportMesh("","","plant_with_color.babylon",e.scene,(function(e){e.forEach((function(e){e.scaling=new d.n(.4,.4,.4)}))}))}},{key:"setupLights",value:function(){new d.b("Omni",new d.n(-7,5,17),e.scene),new d.g("Omni",new d.n(-3,5,13),e.scene)}}]),e}();v.cameraDistance=1.5;var k=n(188),g=function(){function e(t,n){Object(u.a)(this,e);this.id=t,this.mesh=d.f.CreateBox("avatar",{height:3,width:1,depth:1},v.scene),this.mesh.position=d.n.Zero(),this.mesh.position.x=0,this.mesh.position.y=1.5,this.mesh.position.z=0,this.mesh.material=e.material,this.billboard=new m(this.mesh,n),e.all.push(this)}return Object(h.a)(e,[{key:"destroy",value:function(){this.billboard.mesh.dispose(),this.mesh.dispose()}},{key:"transform",value:function(e,t,n,i){this.mesh.position.x=e,this.mesh.position.y=t,this.mesh.position.z=n,this.mesh.rotationQuaternion=d.h.FromEulerAngles(0,-i,0)}}],[{key:"find",value:function(t,n){var i,a=Object(k.a)(e.all);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(o.id===t)return o}}catch(r){a.e(r)}finally{a.f()}return console.log(t,n),new e(t,n)}},{key:"init",value:function(){e.material=new d.k("matPlayer",v.scene),e.material.diffuseColor=new d.a.Red}},{key:"move",value:function(t){var n=parseInt(t.id);e.find(n,t.username).transform(t.x,t.y,t.z,t.rotation)}},{key:"remove",value:function(t){var n,i=Object(k.a)(e.all);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a.id===t.id){a.destroy();break}}}catch(o){i.e(o)}finally{i.f()}e.all=e.all.filter((function(e){return e.id!==t.id}))}}]),e}();g.all=new Array;var b=n(224),j=n.n(b),y=function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,null,[{key:"init",value:function(){e.currentRoomId=null,e.socket=j()(),e.socket.on("auth",(function(t){t.success?(e.currentRoomId=t.roomId,v.init(),g.init(),w.init(t.username),p.init()):console.log("THAT ROOM DOESN'T EXIST")})),e.socket.on("transform",(function(e){switch(console.log(e),e.command){case"playerGone":g.remove(e);break;case"playerMoved":g.move(e)}}))}},{key:"login",value:function(t,n){e.socket.emit("login",{username:t,roomId:n})}}]),e}(),O=function(e){var t=Object(a.useState)(""),n=Object(l.a)(t,2),o=n[0],r=n[1];return console.log(e.roomId),Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Welcome"}),Object(i.jsx)("span",{children:"Username: "}),Object(i.jsx)("input",{onChange:function(e){return r(e.target.value)},type:"text",id:"username"}),Object(i.jsx)("button",{id:"login",onClick:function(){return y.login(o,e.roomId)},children:e.roomId?"Join Group":"Create Group"})]})},x=(n(261),n(189)),C=n.n(x),E=n(50);y.init();var I=function(e){var t=Object(a.useRef)();return Object(a.useEffect)((function(){e.peer.on("stream",(function(e){t.current.srcObject=e}))}),[]),Object(i.jsx)("audio",{autoPlay:!0,ref:t})},D=function(e){var t=Object(a.useState)([]),n=Object(l.a)(t,2),o=n[0],r=n[1],s=Object(a.useRef)(),u=(Object(a.useRef)(),Object(a.useRef)([])),h=Object(E.f)().roomId;return console.log(h),Object(a.useEffect)((function(){s.current=y.socket,navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){s.current.on("all users",(function(t){var n=[];t.forEach((function(t){var i=function(e,t,n){var i=new C.a({initiator:!0,trickle:!1,stream:n});return i.on("signal",(function(n){s.current.emit("sending signal",{userToSignal:e,callerID:t,signal:n})})),i}(t,s.current.id,e);u.current.push({peerID:t,peer:i}),n.push(i)})),r(n)})),s.current.on("user joined",(function(t){var n=function(e,t,n){var i=new C.a({initiator:!1,trickle:!1,stream:n});return i.on("signal",(function(e){s.current.emit("returning signal",{signal:e,callerID:t})})),i.signal(e),i}(t.signal,t.callerID,e);u.current.push({peerID:t.callerID,peer:n}),r((function(e){return[].concat(Object(c.a)(e),[n])}))})),s.current.on("receiving returned signal",(function(e){u.current.find((function(t){return t.peerID===e.id})).peer.signal(e.signal)}))}))}),[]),Object(i.jsxs)("div",{children:[Object(i.jsx)(O,{roomId:h}),o.map((function(e,t){return Object(i.jsx)(I,{peer:e},t)})),Object(i.jsx)("p",{children:y.currentRoomId}),Object(i.jsx)("canvas",{id:"canvas",style:{width:"100%",height:"100%"}})]})},B=n(187),L=function(){return Object(i.jsx)(B.a,{children:Object(i.jsx)(E.c,{children:Object(i.jsx)(E.a,{path:"/:roomId?",children:Object(i.jsx)(D,{})})})})},T=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,284)).then((function(t){var n=t.getCLS,i=t.getFID,a=t.getFCP,o=t.getLCP,r=t.getTTFB;n(e),i(e),a(e),o(e),r(e)}))};s.a.render(Object(i.jsx)(o.a.StrictMode,{children:Object(i.jsx)(L,{})}),document.getElementById("root")),T()}},[[283,1,2]]]);
//# sourceMappingURL=main.b3c0642d.chunk.js.map