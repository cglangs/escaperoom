(this.webpackJsonpescapegame=this.webpackJsonpescapegame||[]).push([[0],{288:function(e,t,n){},319:function(e,t,n){},326:function(e,t){},328:function(e,t){},342:function(e,t,n){"use strict";n.r(t);var i=n(61),a=n(35),o=n.n(a),r=n(279),s=n.n(r),c=(n(288),n(282)),l=n(224),d=n(90),h=n(91),u=n(11),w=n(77),p=function(){function e(t,n){Object(d.a)(this,e),console.log(n),this.playerMesh=t,this.username=n,this.create()}return Object(h.a)(e,[{key:"create",value:function(){this.mesh=u.l.CreatePlane("billboard",{width:e.width,height:e.height},g.scene),this.mesh.position=u.t.Zero(),this.mesh.position.y=m.height-e.height;var t=w.a.CreateForMesh(this.mesh,1024,256);t.name="AvatarBillboard";var n=new w.e("container");n.thickness=0,n.height="100px",n.width="800px",t.addControl(n),this.text=new w.f,this.text.fontFamily="Arial",this.text.fontWeight="bold",this.text.color="white",this.text.outlineColor="black",this.text.outlineWidth=40,this.text.fontSize=100,n.addControl(this.text),this.text.text=this.username,this.mesh.billboardMode=u.k.BILLBOARDMODE_ALL,this.mesh.parent=this.playerMesh}}]),e}();p.height=1,p.width=3;var f=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"init",value:function(){window.addEventListener("keydown",this.keydownEvent),window.addEventListener("keyup",this.keyupEvent),window.addEventListener("blur",this.keyupEvent)}},{key:"keydownEvent",value:function(t){switch(t.keyCode){case 38:case 87:t.preventDefault(),e.key.up=!0;break;case 37:case 65:e.key.left=!0;break;case 39:case 68:e.key.right=!0;break;case 40:case 83:e.key.down=!0}}},{key:"keyupEvent",value:function(t){switch(t.keyCode){case 38:case 87:t.preventDefault(),e.key.up=!1;break;case 37:case 65:e.key.left=!1;break;case 39:case 68:e.key.right=!1;break;case 40:case 83:e.key.down=!1}}}]),e}();f.key={down:!1,up:!1,left:!1,right:!1};var m=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"init",value:function(t){e.mesh=u.l.CreateBox("avatar",{height:e.height,width:1,depth:1},g.scene),e.mesh.position=u.t.Zero(),e.mesh.position.y=e.height/2,e.mesh.isVisible=!1,e.username=t}},{key:"send",value:function(){var t=e.mesh.position.x,n=e.mesh.position.y,i=e.mesh.position.z,a=e.absoluteRotation;x.socket.emit("transform",{command:"playerMoved",x:t,y:n,z:i,rotation:a})}},{key:"update",value:function(t,n){null!==e.mesh&&(e.mesh.position=t,e.absoluteRotation+=n.y,e.send())}}]),e}();m.absoluteRotation=0,m.height=3,m.mesh=null,m.rotationSpeed=.01,m.walkSpeed=.007;n(341),n(289);u.d.prototype.displayLoadingUI=function(){if(document.getElementById("customLoadingScreenDiv"))document.getElementById("customLoadingScreenDiv").style.display="initial";else{this._loadingDiv=document.createElement("div"),this._loadingDiv.id="customLoadingScreenDiv",this._loadingDiv.innerHTML="Preparing room...";var e=document.createElement("style");e.type="text/css",e.innerHTML="\n    #customLoadingScreenDiv{\n        background-color: lightBlue;\n        color: white;\n        font-size:50px;\n        text-align:center;\n        padding-top: 20%;\n    }\n    ",document.getElementsByTagName("head")[0].appendChild(e),this._resizeLoadingUI(),window.addEventListener("resize",this._resizeLoadingUI),document.body.appendChild(this._loadingDiv)}};var g=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"init",value:function(){e.canvas=document.getElementById("canvas");var t=new u.g(e.canvas,!0);e.booksClicked=0,e.scene=new u.o(t),e.scene.gravity=new u.t(0,-.9,0),e.scene.collisionsEnabled=!0,e.setupCamera(),e.setupLights(),e.setupGround(),e.setupWalls(),t.runRenderLoop((function(){e.scene.render(),m.update(e.camera.position,e.camera.cameraRotation)})),t.displayLoadingUI(),e.scene.executeWhenReady((function(){document.getElementById("customLoadingScreenDiv").remove()})),window.addEventListener("resize",(function(){t.resize()}))}},{key:"roomModification",value:function(t){switch(t){case 1:e.scene.getMeshByName("safeFront").dispose(),e.scene.getMeshByName("safeFrontBorder").dispose()}}},{key:"setupCamera",value:function(){e.camera=new u.i("FreeCamera",new u.t(-5,2,-5),e.scene),e.camera.attachControl(e.canvas,!0),e.scene.activeCamera=e.camera,e.camera.checkCollisions=!0,e.camera.applyGravity=!0,e.camera.ellipsoid=new u.t(1.3,1.3,1.3),e.camera.speed=.1,e.camera.keysUp.push(87),e.camera.keysDown.push(83),e.camera.keysRight.push(68),e.camera.keysLeft.push(65),e.arcCamera=new u.b("ArcCamera",3*Math.PI/2,3*Math.PI/8,3,new u.t(0,0,0),e.scene),e.arcCamera.layerMask=268435456}},{key:"setupGround",value:function(){var t=u.k.CreatePlane("ground",20,e.scene);t.material=new u.q("groundMat",e.scene),t.material.diffuseTexture=new u.r("wood_floor_texture.jpg",e.scene),t.position=new u.t(0,0,0),t.rotation=new u.t(Math.PI/2,0,0),t.checkCollisions=!0;var n=u.l.CreatePlane("hallway",{width:4,height:10,sideOrientation:u.k.DOUBLESIDE},e.scene);n.position=new u.t(5,0,15),n.rotation=new u.t(Math.PI/2,0,0),n.checkCollisions=!0;var i=u.l.CreatePlane("turn",{width:8,height:4,sideOrientation:u.k.DOUBLESIDE},e.scene);i.position=new u.t(7,0,20),i.rotation=new u.t(Math.PI/2,0,0),i.checkCollisions=!0;var a=u.l.CreatePlane("secretRoom",{width:8,height:10,sideOrientation:u.k.DOUBLESIDE},e.scene);a.position=new u.t(15,0,20),a.rotation=new u.t(Math.PI/2,0,0),a.checkCollisions=!0}},{key:"openDrawer",value:function(t){var n,i,a=[new u.t(0,0,0),new u.t(0,.5,0)],o=u.l.CreateTube("currentDrawer",{path:a,tessellation:4,cap:1,radius:1,sideOrientation:u.k.DOUBLESIDE,updatable:!0},e.scene);switch(o.material=new u.q("",e.scene),o.material.diffuseTexture=new u.r("desk_texture.png",e.scene),o.layerMask=268435456,t){case 1:n=new u.c.Blue,i="I";break;case 2:n=new u.c(0,206/255,209/255),i="II";break;case 3:n=new u.c.Green,i="III";break;case 4:n=new u.c.Red,i="IV"}var r=u.l.CreateBox("clue",{width:.1,height:.1,depth:.1,sideOrientation:u.k.DOUBLESIDE},e.scene);r.position.y=.051,r.material=new u.q("",e.scene),r.material.diffuseColor=n,r.parent=o,r.layerMask=268435456;var s=u.l.CreatePlane("drawerLabel",{width:1,height:1,sideOrientation:u.k.DOUBLESIDE},e.scene);s.position.y=-.001,s.material=new u.q("",e.scene),s.material.diffuseTexture=new u.f("dynamic texture",{width:512,height:256},e.scene),s.material.diffuseTexture.drawText(i,100,100,"bold 70px Segoe UI","black","transparent",!0,!0),s.material.diffuseTexture.hasAlpha=!0,s.rotation=new u.t(u.s.ToRadians(90),0,0),s.parent=o,s.layerMask=268435456,e.scene.activeCamera=e.arcCamera,e.arcCamera.attachControl(e.canvas,!0);var c=new u.j("light1",new u.t(1,1,.5),e.scene),l=w.a.CreateFullscreenUI("UI");l.layer.layerMask=268435456;var d=w.b.CreateImageButton("but","Return","");d.horizontalAlignment=w.c.HORIZONTAL_ALIGNMENT_RIGHT,d.verticalAlignment=w.c.VERTICAL_ALIGNMENT_TOP,d.width=.1,d.height="40px",d.color="white",d.background="green",d.onPointerUpObservable.add((function(){e.closeDrawer(o,c)})),l.addControl(d)}},{key:"closeDrawer",value:function(t,n){t.dispose(),e.scene.activeCamera=e.camera,n.dispose()}},{key:"openNumPad",value:function(e,t){var n=w.a.CreateFullscreenUI("UI"),i=new w.d;i.width=.05,i.maxWidth=.05,i.height="40px",i.color="white",i.background="black",n.addControl(i);var a=w.b.CreateImageButton("SubmitButton","Submit","");a.horizontalAlignment=w.c.HORIZONTAL_ALIGNMENT_RIGHT,a.verticalAlignment=w.c.VERTICAL_ALIGNMENT_BOTTOM,a.width=.1,a.height="40px",a.color="white",a.background="black",n.addControl(a);var o=new w.g;o.addKeysRow(["1","2","3","4","5","6","7","8","9","0","\u2190"]),o.verticalAlignment=w.c.VERTICAL_ALIGNMENT_BOTTOM,n.addControl(o),o.connect(i),n.moveFocusToControl(i),i.onBlurObservable.add((function(){e.dispose(),t.dispose(),i.dispose(),a.dispose(),x.socket.emit("room modified",{actionCode:1})}))}},{key:"setupWalls",value:function(){var t=u.l.CreateBox("wall1Left",{width:13,height:10,depth:2,sideOrientation:u.k.DOUBLESIDE},e.scene);t.checkCollisions=!0,t.material=new u.q(""),t.position=new u.t(-3.5,1,11),t.material.diffuseTexture=new u.r("office_wall_texture.jpg",e.scene);var n=u.l.CreateBox("wall1HiddenDoor",{width:4,height:10,depth:2,sideOrientation:u.k.DOUBLESIDE},e.scene);n.checkCollisions=!0,n.material=new u.q(""),n.position=new u.t(5,1,11),n.material.diffuseTexture=new u.r("office_wall_texture.jpg",e.scene);var i=u.l.CreateBox("wall1Right",{width:3,height:10,depth:2,sideOrientation:u.k.DOUBLESIDE},e.scene);i.checkCollisions=!0,i.material=new u.q(""),i.position=new u.t(8.5,1,11),i.material.diffuseTexture=new u.r("office_wall_texture.jpg",e.scene);var a=u.l.CreateBox("wall2Left",{width:8,height:10,depth:2,sideOrientation:u.k.DOUBLESIDE},e.scene);a.checkCollisions=!0,a.position=new u.t(11,1,-6),a.material=new u.q(""),a.rotation=new u.t(0,u.s.ToRadians(90),0),a.material.diffuseTexture=new u.r("office_wall_texture.jpg",e.scene);var o=u.l.CreateBox("wall2Right",{width:8,height:10,depth:2,sideOrientation:u.k.DOUBLESIDE},e.scene);o.checkCollisions=!0,o.position=new u.t(11,1,6),o.material=new u.q(""),o.rotation=new u.t(0,u.s.ToRadians(90),0),o.material.diffuseTexture=new u.r("office_wall_texture.jpg",e.scene);var r=u.l.CreateBox("wall2Arch",{width:4,height:4,depth:2,sideOrientation:u.k.DOUBLESIDE},e.scene);r.checkCollisions=!0,r.position=new u.t(11,4,0),r.material=new u.q(""),r.rotation=new u.t(0,u.s.ToRadians(90),0),r.material.diffuseTexture=new u.r("office_wall_texture.jpg",e.scene);var s=u.l.CreateBox("wall2Base",{width:4,height:2,depth:2,sideOrientation:u.k.DOUBLESIDE},e.scene);s.checkCollisions=!0,s.position=new u.t(11,-1,0),s.material=new u.q(""),s.rotation=new u.t(0,u.s.ToRadians(90),0),s.material.diffuseTexture=new u.r("office_wall_texture.jpg",e.scene);var c=u.l.CreatePlane("safeBack",{height:5,width:4},e.scene);c.position=new u.t(12,1,0),c.material=new u.q("",e.scene),c.rotation=new u.t(0,u.s.ToRadians(90),0),c.checkCollisions=!0;var l=u.l.CreatePlane("safeBackBorder",{height:5,width:4},e.scene);l.position=new u.t(11.5,1,0),l.rotation=new u.t(0,u.s.ToRadians(90),0),l.checkCollisions=!0,l.isVisible=!1;var d=u.l.CreatePlane("safeFront",{height:2,width:4},e.scene);d.position=new u.t(10,1,0),d.material=new u.q("",e.scene),d.rotation=new u.t(0,u.s.ToRadians(90),0),d.material.diffuseTexture=new u.r("safe_texture.png",e.scene),c.checkCollisions=!0,d.actionManager=new u.a(e.scene),d.actionManager.registerAction(new u.h({trigger:u.a.OnPickTrigger},(function(){e.openNumPad(d,h)})));var h=u.l.CreatePlane("safeFrontBorder",{height:2,width:4},e.scene);h.position=new u.t(9.5,1,0),h.rotation=new u.t(0,u.s.ToRadians(90),0),h.checkCollisions=!0,h.isVisible=!1;var w=u.l.CreateBox("wall3",{width:20,height:10,depth:2,sideOrientation:u.k.DOUBLESIDE},e.scene);w.checkCollisions=!0,w.material=new u.q(""),w.position=new u.t(0,1,-11),w.material.diffuseTexture=new u.r("office_wall_texture.jpg",e.scene);var p=u.l.CreateBox("wall4Left",{width:8,height:10,depth:2,sideOrientation:u.k.DOUBLESIDE},e.scene);p.checkCollisions=!0,p.position=new u.t(-11,1,-6),p.material=new u.q(""),p.rotation=new u.t(0,u.s.ToRadians(90),0),p.material.diffuseTexture=new u.r("office_wall_texture.jpg",e.scene);var f=u.l.CreateBox("wall4Right",{width:8,height:10,depth:2,sideOrientation:u.k.DOUBLESIDE},e.scene);f.checkCollisions=!0,f.position=new u.t(-11,1,6),f.material=new u.q(""),f.rotation=new u.t(0,u.s.ToRadians(90),0),f.material.diffuseTexture=new u.r("office_wall_texture.jpg",e.scene);var m=u.l.CreateBox("wall4Arch",{width:4,height:2,depth:2,sideOrientation:u.k.DOUBLESIDE},e.scene);m.checkCollisions=!0,m.position=new u.t(-11,5,0),m.material=new u.q(""),m.rotation=new u.t(0,u.s.ToRadians(90),0),m.material.diffuseTexture=new u.r("office_wall_texture.jpg",e.scene);var g=u.l.CreateBox("wall4Door",{width:4,height:4,depth:2,sideOrientation:u.k.DOUBLESIDE},e.scene);g.checkCollisions=!0,g.position=new u.t(-11,2,0),g.material=new u.q(""),g.rotation=new u.t(0,u.s.ToRadians(90),0),g.material.diffuseTexture=new u.r("double_door_texture.jpg",e.scene);var k=u.l.CreateBox("hallwayLeft",{width:12,height:10,depth:2,sideOrientation:u.k.DOUBLESIDE},e.scene);k.checkCollisions=!0,k.position=new u.t(2,0,18),k.material=new u.q(""),k.rotation=new u.t(0,u.s.ToRadians(90),0),k.material.diffuseTexture=new u.r("dungeon_texture.png",e.scene);var v=u.l.CreateBox("hallwayTurnLeft",{width:8,height:10,depth:4,sideOrientation:u.k.DOUBLESIDE},e.scene);v.checkCollisions=!0,v.position=new u.t(7,0,24),v.material=new u.q(""),v.material.diffuseTexture=new u.r("dungeon_texture.png",e.scene);var O=u.l.CreateBox("secretRoomWall1",{width:8,height:10,depth:2,sideOrientation:u.k.DOUBLESIDE},e.scene);O.checkCollisions=!0,O.position=new u.t(15,0,25),O.material=new u.q(""),O.material.diffuseTexture=new u.r("dungeon_texture.png",e.scene);var C=u.l.CreateBox("secretRoomWall2",{width:10,height:10,depth:2,sideOrientation:u.k.DOUBLESIDE},e.scene);C.checkCollisions=!0,C.position=new u.t(20,0,20),C.material=new u.q(""),C.rotation=new u.t(0,u.s.ToRadians(90),0),C.material.diffuseTexture=new u.r("dungeon_texture.png",e.scene);var x=u.l.CreateBox("secretRoomWall3",{width:8,height:10,depth:2,sideOrientation:u.k.DOUBLESIDE},e.scene);x.checkCollisions=!0,x.position=new u.t(15,0,15),x.material=new u.q(""),x.material.diffuseTexture=new u.r("dungeon_texture.png",e.scene);var b=u.l.CreateBox("secretRoomWall4",{width:7,height:10,depth:4,sideOrientation:u.k.DOUBLESIDE},e.scene);b.checkCollisions=!0,b.position=new u.t(9,0,15.5),b.material=new u.q(""),b.rotation=new u.t(0,u.s.ToRadians(90),0),b.material.diffuseTexture=new u.r("dungeon_texture.png",e.scene);var y=u.l.CreateBox("roof",{width:20,height:2,depth:20,sideOrientation:u.k.DOUBLESIDE},e.scene);y.position=new u.t(0,7,0),y.material=new u.q(""),y.material.diffuseTexture=new u.r("wall_texture.jpg",e.scene),u.p.ImportMesh("","","plant_with_color.babylon",e.scene,(function(t){t.forEach((function(e){e.position=e.position.add(new u.t(-3,0,-3)),e.scaling=new u.t(.4,.4,.4)}));var n=u.l.CreateBox("myBox",{height:13,width:3,depth:3},e.scene);n.isVisible=!1,n.parent=t[1],n.checkCollisions=!0})),u.p.ImportMesh("","","bookshelfFrida.babylon",e.scene,(function(i){console.log(i),i.forEach((function(e){e.parent=t,e.scaling=new u.t(.45,.45,.45),e.rotation=new u.t(u.s.ToRadians(-90),u.s.ToRadians(180),0),e.position=e.position.add(new u.t(8,1,-2))}));var a=u.l.CreateBox("fridaBox",{height:10,width:6,depth:5},e.scene);a.position=a.position.add(new u.t(3,0,-2)),a.rotation=new u.t(u.s.ToRadians(-90),0,0),a.isVisible=!1,a.parent=i[0],a.checkCollisions=!0,e.setUpBooks(i[0],n)})),u.p.ImportMesh("","","chair.glb",e.scene,(function(t){t.forEach((function(e){e.scaling=new u.t(1.5,1.5,1.5),e.position=new u.t(6,0,-5)}));var n=u.l.CreateBox("chairBox",{height:2,width:.55,depth:.7},e.scene);n.isVisible=!1,n.parent=t[1],n.checkCollisions=!0})),u.p.ImportMesh("","","desk.glb",e.scene,(function(t){t.forEach((function(e){e.scaling=new u.t(1.5,1.5,1.5),e.position=new u.t(10,0,-10)}));var n=u.l.CreateBox("deskBox",{height:2,width:1.5,depth:1},e.scene);n.isVisible=!1,n.parent=t[1],n.checkCollisions=!0,e.setUpDrawers(t[1])})),u.p.ImportMesh("","","clock.glb",e.scene,(function(e){e.forEach((function(e){e.parent=t,e.position=e.position.add(new u.t(-2,2,-1)),e.rotation=new u.t(u.s.ToRadians(-90),0,0),e.scaling=new u.t(3.5,3.5,3.5)}))})),u.p.ImportMesh("","","Clock1.babylon",e.scene,(function(t){t.forEach((function(t){t.parent=w,t.position=t.position.add(new u.t(2,2,1)),t.rotation=new u.t(u.s.ToRadians(90),0,0),t.scaling=new u.t(.6,.6,.6);var n=u.l.CreatePlane("clockFace",{width:1.65,height:1.65,sideOrientation:u.k.DOUBLESIDE},e.scene);n.position=n.position.add(new u.t(0,.2,0)),n.rotation=new u.t(u.s.ToRadians(90),0,u.s.ToRadians(180)),n.parent=t,n.material=new u.q(""),n.material.diffuseTexture=new u.r("oldclocktexture.png",e.scene),n.material.diffuseTexture.hasAlpha=!0}))}));var D=u.l.CreatePlane("clockLabel",{width:1,height:1,sideOrientation:u.k.DOUBLESIDE},e.scene);D.parent=t,D.position=D.position.add(new u.t(-2,1.7,-1.1)),D.material=new u.q("",e.scene),D.material.diffuseTexture=new u.f("dynamic texture",{width:512,height:256},e.scene),D.material.diffuseTexture.drawText("X",100,100,"bold 70px Segoe UI","green","transparent",!0,!0),D.material.diffuseTexture.hasAlpha=!0;var E=u.l.CreatePlane("clockLabel",{width:1,height:1,sideOrientation:u.k.DOUBLESIDE},e.scene);E.parent=t,E.position=E.position.add(new u.t(7,2,-2)),E.material=new u.q("",e.scene),E.material.diffuseTexture=new u.f("dynamic texture",{width:512,height:256},e.scene),E.material.diffuseTexture.drawText("X",100,100,"bold 70px Segoe UI","green","transparent",!0,!0),E.material.diffuseTexture.hasAlpha=!0}},{key:"clickBook",value:function(t,n){1===t?e.booksClicked=1:t===e.booksClicked+1&&(e.booksClicked+=1),4===e.booksClicked&&n.dispose()}},{key:"setUpBooks",value:function(t,n){var i=new u.q("invisible",e.scene);i.alpha=0;var a=u.l.CreatePlane("book1",{height:.9,width:.14,sideOrientation:u.k.DOUBLESIDE},e.scene);a.parent=t,a.position=a.position.add(new u.t(3.2,-1.2,-5.2)),a.rotation=new u.t(u.s.ToRadians(90),0,0),a.material=new u.q("",e.scene),a.material.diffuseColor=new u.c.Green,a.material=i,a.actionManager=new u.a(e.scene),a.actionManager.registerAction(new u.h({trigger:u.a.OnPickTrigger},(function(){e.clickBook(3,n)})));var o=u.l.CreatePlane("book2",{height:.9,width:.14,sideOrientation:u.k.DOUBLESIDE},e.scene);o.parent=t,o.position=o.position.add(new u.t(3.04,-1.2,-5.2)),o.rotation=new u.t(u.s.ToRadians(90),0,0),o.material=new u.q("",e.scene),o.material.diffuseColor=new u.c.Red,o.material=i,o.actionManager=new u.a(e.scene),o.actionManager.registerAction(new u.h({trigger:u.a.OnPickTrigger},(function(){e.clickBook(4,n)})));var r=u.l.CreatePlane("book3",{height:.9,width:.14,sideOrientation:u.k.DOUBLESIDE},e.scene);r.parent=t,r.position=r.position.add(new u.t(2.86,-1.2,-5.2)),r.rotation=new u.t(u.s.ToRadians(90),0,0),r.material=new u.q("",e.scene),r.material.diffuseColor=new u.c.Blue,r.material=i,r.actionManager=new u.a(e.scene),r.actionManager.registerAction(new u.h({trigger:u.a.OnPickTrigger},(function(){e.clickBook(1,n)})));var s=u.l.CreatePlane("book4",{height:.9,width:.14,sideOrientation:u.k.DOUBLESIDE},e.scene);s.parent=t,s.position=s.position.add(new u.t(2.68,-1.2,-5.2)),s.rotation=new u.t(u.s.ToRadians(90),0,0),s.material=new u.q("",e.scene),s.material.diffuseColor=new u.c(0,206/255,209/255),s.material=i,s.actionManager=new u.a(e.scene),s.actionManager.registerAction(new u.h({trigger:u.a.OnPickTrigger},(function(){e.clickBook(2,n)})))}},{key:"setUpDrawers",value:function(t){var n=u.l.CreatePlane("plane1",{height:.14,width:.46,sideOrientation:u.k.DOUBLESIDE},e.scene);n.parent=t,n.position=new u.t(.355,.595,.3),n.material=new u.q("",e.scene),n.material.diffuseColor=new u.c.Green,n.actionManager=new u.a(e.scene),n.actionManager.registerAction(new u.h({trigger:u.a.OnPickTrigger},(function(){e.scene.activeCamera==e.camera?e.openDrawer(1):e.closeDrawer()})));var i=u.l.CreatePlane("plane2",{height:.14,width:.46,sideOrientation:u.k.DOUBLESIDE},e.scene);i.parent=t,i.position=new u.t(.355,.445,.3),i.material=new u.q("",e.scene),i.material.diffuseColor=new u.c.Red,i.actionManager=new u.a(e.scene),i.actionManager.registerAction(new u.h({trigger:u.a.OnPickTrigger},(function(){e.scene.activeCamera==e.camera?e.openDrawer(2):e.closeDrawer()})));var a=u.l.CreatePlane("plane3",{height:.14,width:.46,sideOrientation:u.k.DOUBLESIDE},e.scene);a.parent=t,a.position=new u.t(.355,.295,.3),a.material=new u.q("",e.scene),a.material.diffuseColor=new u.c.Blue,a.actionManager=new u.a(e.scene),a.actionManager.registerAction(new u.h({trigger:u.a.OnPickTrigger},(function(){e.scene.activeCamera==e.camera?e.openDrawer(3):e.closeDrawer()})));var o=u.l.CreatePlane("plane4",{height:.14,width:.46,sideOrientation:u.k.DOUBLESIDE},e.scene);o.parent=t,o.position=new u.t(.355,.15,.3),o.material=new u.q("",e.scene),o.material.diffuseColor=new u.c(0,206/255,209/255),o.actionManager=new u.a(e.scene),o.actionManager.registerAction(new u.h({trigger:u.a.OnPickTrigger},(function(){e.scene.activeCamera==e.camera?e.openDrawer(4):e.closeDrawer()})))}},{key:"setupLights",value:function(){new u.e("Omni",new u.t(-7,5,17),e.scene),new u.m("Omni",new u.t(-3,5,13),e.scene)}}]),e}();g.cameraDistance=1.5;var k=n(239),v=function(){function e(t,n){Object(d.a)(this,e);this.id=t,this.mesh=u.l.CreateBox("avatar",{height:3,width:1,depth:1},g.scene),this.mesh.position=u.t.Zero(),this.mesh.position.x=0,this.mesh.position.y=1.5,this.mesh.position.z=0,this.mesh.material=e.material,this.billboard=new p(this.mesh,n),e.all.push(this)}return Object(h.a)(e,[{key:"destroy",value:function(){this.billboard.mesh.dispose(),this.mesh.dispose()}},{key:"transform",value:function(e,t,n,i){this.mesh.position.x=e,this.mesh.position.y=t,this.mesh.position.z=n,this.mesh.rotationQuaternion=u.n.FromEulerAngles(0,-i,0)}}],[{key:"find",value:function(t,n){var i,a=Object(k.a)(e.all);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(o.id===t)return o}}catch(r){a.e(r)}finally{a.f()}return console.log(t,n),new e(t,n)}},{key:"init",value:function(){e.material=new u.q("matPlayer",g.scene),e.material.diffuseColor=new u.c.Red}},{key:"move",value:function(t){var n=parseInt(t.id);e.find(n,t.username).transform(t.x,t.y,t.z,t.rotation)}},{key:"remove",value:function(t){var n,i=Object(k.a)(e.all);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a.id===t.id){a.destroy();break}}}catch(o){i.e(o)}finally{i.f()}e.all=e.all.filter((function(e){return e.id!==t.id}))}}]),e}();v.all=new Array;var O=n(280),C=n.n(O),x=function(){function e(){Object(d.a)(this,e)}return Object(h.a)(e,null,[{key:"init",value:function(){e.currentRoomId=null,e.socket=C()("http://localhost:3001/",{reconnectionDelayMax:1e4}),e.socket.on("auth",(function(t){t.success?(e.currentRoomId=t.roomId,g.init(),v.init(),m.init(t.username),f.init()):console.log("THAT ROOM DOESN'T EXIST")})),e.socket.on("transform",(function(e){switch(e.command){case"playerGone":v.remove(e);break;case"playerMoved":v.move(e)}})),e.socket.on("room modified",(function(e){g.roomModification(e.actionCode)}))}},{key:"login",value:function(t,n){e.socket.emit("login",{username:t,roomId:n})}}]),e}(),b=function(e){var t=Object(a.useState)(""),n=Object(l.a)(t,2),o=n[0],r=n[1];return Object(i.jsxs)("div",{children:[Object(i.jsx)("h1",{children:"Welcome"}),Object(i.jsx)("span",{children:"Username: "}),Object(i.jsx)("input",{onChange:function(e){return r(e.target.value)},type:"text",id:"username"}),Object(i.jsx)("button",{id:"login",onClick:function(){return x.login(o,e.roomId)},children:e.roomId?"Join Group":"Create Group"})]})},y=(n(319),n(240)),D=n.n(y),E=n(59);x.init();var I=function(e){var t=Object(a.useRef)();return Object(a.useEffect)((function(){e.peer.on("stream",(function(e){t.current.srcObject=e}))}),[]),Object(i.jsx)("audio",{autoPlay:!0,ref:t})},T=function(e){var t=Object(a.useState)([]),n=Object(l.a)(t,2),o=n[0],r=n[1],s=Object(a.useRef)(),d=(Object(a.useRef)(),Object(a.useRef)([])),h=Object(E.f)().roomId;return Object(a.useEffect)((function(){s.current=x.socket,navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){s.current.on("all users",(function(t){var n=[];t.forEach((function(t){var i=function(e,t,n){var i=new D.a({initiator:!0,trickle:!1,stream:n});return i.on("signal",(function(n){s.current.emit("sending signal",{userToSignal:e,callerID:t,signal:n})})),i}(t,s.current.id,e);d.current.push({peerID:t,peer:i}),n.push(i)})),r(n)})),s.current.on("user joined",(function(t){var n=function(e,t,n){var i=new D.a({initiator:!1,trickle:!1,stream:n});return i.on("signal",(function(e){s.current.emit("returning signal",{signal:e,callerID:t})})),i.signal(e),i}(t.signal,t.callerID,e);d.current.push({peerID:t.callerID,peer:n}),r((function(e){return[].concat(Object(c.a)(e),[n])}))})),s.current.on("receiving returned signal",(function(e){d.current.find((function(t){return t.peerID===e.id})).peer.signal(e.signal)}))}))}),[]),Object(i.jsxs)("div",{children:[Object(i.jsx)(b,{roomId:h}),o.map((function(e,t){return Object(i.jsx)(I,{peer:e},t)})),Object(i.jsx)("p",{children:x.currentRoomId&&"Share this link to invite others to your escape room: "+window.location.href+x.currentRoomId}),Object(i.jsx)("canvas",{id:"canvas",style:{width:"100%",height:"100%"}})]})},B=n(238),L=function(){return Object(i.jsx)(B.a,{children:Object(i.jsx)(E.c,{children:Object(i.jsx)(E.a,{path:"/:roomId?",children:Object(i.jsx)(T,{})})})})},j=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,343)).then((function(t){var n=t.getCLS,i=t.getFID,a=t.getFCP,o=t.getLCP,r=t.getTTFB;n(e),i(e),a(e),o(e),r(e)}))};s.a.render(Object(i.jsx)(o.a.StrictMode,{children:Object(i.jsx)(L,{})}),document.getElementById("root")),j()}},[[342,1,2]]]);
//# sourceMappingURL=main.3c6b7b58.chunk.js.map